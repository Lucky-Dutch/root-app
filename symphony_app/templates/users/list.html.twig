<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Lista użytkowników</title>
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: #f7f8fa;
            color: #222;
            margin: 0;
            padding: 0;
        }
        h1 {
            font-weight: 600;
            letter-spacing: -1px;
            margin-top: 32px;
            margin-bottom: 24px;
            text-align: center;
        }
        a {
            color: #2563eb;
            text-decoration: none;
            margin-right: 8px;
            transition: color 0.2s;
        }
        a:hover {
            color: #1e40af;
            text-decoration: underline;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.06);
            padding: 32px 24px;
        }
        .filter-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px 16px;
            margin-bottom: 18px;
            background: #fff;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.03);
        }
        .filter-form .field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .filter-form label {
            font-size: 0.9em;
            color: #374151;
        }
        .filter-form input[type="text"],
        .filter-form input[type="date"],
        .filter-form select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.98em;
            background: #fff;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.15s, box-shadow 0.15s;
        }
        .filter-form input[type="text"]:focus,
        .filter-form input[type="date"]:focus,
        .filter-form select:focus {
            border-color: #93c5fd;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
        }
        .filter-actions {
            grid-column: 1 / -1;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        .btn {
            display: inline-block;
            padding: 8px 18px;
            border-radius: 8px;
            font-weight: 500;
            letter-spacing: 0.5px;
            transition: background 0.2s;
            border: none;
            cursor: pointer;
        }
        .btn-primary {
            background: #2563eb;
            color: #fff;
        }
        .btn-primary:hover {
            background: #1e40af;
        }
        .btn-secondary {
            background: #f1f5f9;
            color: #111827;
            text-decoration: none;
        }
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 4px rgba(0,0,0,0.03);
        }
        th, td {
            padding: 14px 12px;
            text-align: left;
        }
        th {
            background: #f1f5f9;
            font-weight: 500;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e5e7eb;
        }
        tr {
            transition: background 0.15s;
        }
        tr:nth-child(even) {
            background: #f9fafb;
        }
        tr:hover {
            background: #e0e7ef;
        }
        .actions a {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.97em;
            background: #f1f5f9;
            margin-right: 4px;
        }
        .actions a:hover {
            background: #dbeafe;
        }
        .add-btn {
            display: inline-block;
            margin-bottom: 18px;
            padding: 8px 18px;
            background: #2563eb;
            color: #fff;
            border-radius: 8px;
            font-weight: 500;
            letter-spacing: 0.5px;
            transition: background 0.2s;
        }
        .add-btn:hover {
            background: #1e40af;
            color: #fff;
        }
        .sort-indicator {
            font-size: 0.85em;
            margin-left: 6px;
            color: #6b7280;
        }
        @media (max-width: 700px) {
            .container { padding: 10px 2px; }
            .filter-form { grid-template-columns: 1fr; }
            table, thead, tbody, th, td, tr { display: block; }
            th, td { padding: 10px 6px; }
            tr { margin-bottom: 12px; }
            th { background: none; border: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Lista użytkowników</h1>

        <a href="{{ path('user_add') }}" class="add-btn">Dodaj użytkownika</a>

        {# Filter form (GET user_list) #}
        <form class="filter-form" action="{{ path('user_list') }}" method="get">
            <div class="field">
                <label for="first_name">Imię</label>
                <input type="text" id="first_name" name="first_name" value="{{ app.request.query.get('first_name') }}">
            </div>
            <div class="field">
                <label for="last_name">Nazwisko</label>
                <input type="text" id="last_name" name="last_name" value="{{ app.request.query.get('last_name') }}">
            </div>
            <div class="field">
                <label for="gender">Płeć</label>
                <select id="gender" name="gender">
                    <option value="" {{ app.request.query.get('gender') is empty ? 'selected' : '' }}>— wszystkie —</option>
                    <option value="female" {{ app.request.query.get('gender') == 'female' ? 'selected' : '' }}>Kobieta</option>
                    <option value="male" {{ app.request.query.get('gender') == 'male' ? 'selected' : '' }}>Mężczyzna</option>
                </select>
            </div>
            <div class="field">
                <label for="birthdate_from">Data urodzenia od</label>
                <input type="date" id="birthdate_from" name="birthdate_from" value="{{ app.request.query.get('birthdate_from') }}">
            </div>
            <div class="field">
                <label for="birthdate_to">Data urodzenia do</label>
                <input type="date" id="birthdate_to" name="birthdate_to" value="{{ app.request.query.get('birthdate_to') }}">
            </div>

            <div class="filter-actions">
                <button type="submit" class="btn btn-primary">Filtruj</button>
                <a class="btn btn-secondary" href="{{ path('user_list') }}">Wyczyść</a>
            </div>
        </form>

        {% set current_sort = app.request.query.get('sort') %}
        {% set current_dir = app.request.query.get('direction')|default('asc') %}

        <table>
            <thead>
                <tr>
                    <th>
                        {% set next_dir = (current_sort == 'id' and current_dir == 'asc') ? 'desc' : 'asc' %}
                        <a href="{{ path('user_list', {
                            sort: 'id',
                            direction: next_dir,
                            first_name: app.request.query.get('first_name'),
                            last_name: app.request.query.get('last_name'),
                            gender: app.request.query.get('gender'),
                            birthdate_from: app.request.query.get('birthdate_from'),
                            birthdate_to: app.request.query.get('birthdate_to')
                        }) }}">ID</a>
                        {% if current_sort == 'id' %}<span class="sort-indicator">{{ current_dir == 'asc' ? '▲' : '▼' }}</span>{% endif %}
                    </th>
                    <th>
                        {% set next_dir = (current_sort == 'first_name' and current_dir == 'asc') ? 'desc' : 'asc' %}
                        <a href="{{ path('user_list', {
                            sort: 'first_name',
                            direction: next_dir,
                            first_name: app.request.query.get('first_name'),
                            last_name: app.request.query.get('last_name'),
                            gender: app.request.query.get('gender'),
                            birthdate_from: app.request.query.get('birthdate_from'),
                            birthdate_to: app.request.query.get('birthdate_to')
                        }) }}">Imię</a>
                        {% if current_sort == 'first_name' %}<span class="sort-indicator">{{ current_dir == 'asc' ? '▲' : '▼' }}</span>{% endif %}
                    </th>
                    <th>
                        {% set next_dir = (current_sort == 'last_name' and current_dir == 'asc') ? 'desc' : 'asc' %}
                        <a href="{{ path('user_list', {
                            sort: 'last_name',
                            direction: next_dir,
                            first_name: app.request.query.get('first_name'),
                            last_name: app.request.query.get('last_name'),
                            gender: app.request.query.get('gender'),
                            birthdate_from: app.request.query.get('birthdate_from'),
                            birthdate_to: app.request.query.get('birthdate_to')
                        }) }}">Nazwisko</a>
                        {% if current_sort == 'last_name' %}<span class="sort-indicator">{{ current_dir == 'asc' ? '▲' : '▼' }}</span>{% endif %}
                    </th>
                    <th>
                        {% set next_dir = (current_sort == 'gender' and current_dir == 'asc') ? 'desc' : 'asc' %}
                        <a href="{{ path('user_list', {
                            sort: 'gender',
                            direction: next_dir,
                            first_name: app.request.query.get('first_name'),
                            last_name: app.request.query.get('last_name'),
                            gender: app.request.query.get('gender'),
                            birthdate_from: app.request.query.get('birthdate_from'),
                            birthdate_to: app.request.query.get('birthdate_to')
                        }) }}">Płeć</a>
                        {% if current_sort == 'gender' %}<span class="sort-indicator">{{ current_dir == 'asc' ? '▲' : '▼' }}</span>{% endif %}
                    </th>
                    <th>
                        {% set next_dir = (current_sort == 'birthdate' and current_dir == 'asc') ? 'desc' : 'asc' %}
                        <a href="{{ path('user_list', {
                            sort: 'birthdate',
                            direction: next_dir,
                            first_name: app.request.query.get('first_name'),
                            last_name: app.request.query.get('last_name'),
                            gender: app.request.query.get('gender'),
                            birthdate_from: app.request.query.get('birthdate_from'),
                            birthdate_to: app.request.query.get('birthdate_to')
                        }) }}">Data urodzenia</a>
                        {% if current_sort == 'birthdate' %}<span class="sort-indicator">{{ current_dir == 'asc' ? '▲' : '▼' }}</span>{% endif %}
                    </th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.first_name }}</td>
                        <td>{{ user.last_name }}</td>
                        <td>{{ user.gender }}</td>
                        <td>{{ user.birthdate }}</td>
                        <td class="actions">
                            <a href="{{ path('user_show', { id: user.id }) }}">Pokaż</a>
                            <a href="{{ path('user_edit', { id: user.id }) }}">Edytuj</a>
                            <a href="{{ path('user_delete', { id: user.id }) }}" data-method="delete" onclick="return confirm('Are you sure you want to delete this item?');">Delete</a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="6">Brak użytkowników.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>